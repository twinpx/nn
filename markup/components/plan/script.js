!function(m){"use strict";m(function(){ymaps.ready(function(){var a=new ymaps.Map("planYmap",{center:window.planYmapCenter,zoom:window.planYmapZoom,controls:["zoomControl","typeSelector"]},{yandexMapDisablePoiInteractivity:!0}),e={},o={},l={},n={build:function(){this.constructor.superclass.build.call(this),this._$element=m(".b-balloon",this.getParentElement()),this.applyElementOffset(),this._$element.find(".b-balloon__close").on("click",m.proxy(this.onCloseClick,this))},clear:function(){this._$element.find(".b-balloon__close").off("click"),this.constructor.superclass.clear.call(this)},applyElementOffset:function(){this._$element.css({left:-this._$element[0].offsetWidth/2,top:-this._$element[0].offsetHeight})},onCloseClick:function(e){e.preventDefault(),this.events.fire("userclose")},_isElement:function(e){return e&&e[0]&&e.find(".arrow")[0]}},s={},t={};if(a.events.add("boundschange",function(e){e.get("newZoom")!==e.get("oldZoom")&&d()}),a.behaviors.disable("scrollZoom"),a.events.add("click",function(e){a.balloon.close()}),window.planPlacemarks)for(var i in window.planPlacemarks){if("infrastructure"===i){e[i]=ymaps.templateLayoutFactory.createClass('<div class="b-placemark-icon i-'+i+'" style="background-image: url( $[properties.src] );"></div>'),o[i]=ymaps.templateLayoutFactory.createClass('<div class="b-balloon i-'+i+'"><div class="b-balloon__close"></div><div class="b-balloon__icon" style="background-image: url(\'$[properties.src]\');"></div><div class="b-balloon__heading">$[properties.heading]</div></div>',n),t[i]=[];for(var r=0;r<window.planPlacemarks[i].length;r++)l=window.planPlacemarks[i][r],t[i][r]=new ymaps.Placemark(l.coords,{name:l.num,heading:l.name,src:l.src},{iconLayout:e[i],iconShape:{type:"Rectangle",coordinates:[[-16,-16],[16,16]]},balloonShadow:!1,balloonLayout:o[i]})}else{e[i]=ymaps.templateLayoutFactory.createClass('<div class="b-placemark-icon i-'+i+'">$[properties.name]</div>'),o[i]=ymaps.templateLayoutFactory.createClass('<div class="b-balloon i-'+i+'"><div class="b-balloon__close"></div><div class="b-balloon__name">$[properties.name]</div><div class="b-balloon__heading">$[properties.heading]</div><div class="b-balloon__props">$[properties.props]</div><div class="b-balloon__button"><a href="$[properties.href]">Все предложения</a></div></div>',n),t[i]=[];for(var c=0;c<window.planPlacemarks[i].length;c++)l=window.planPlacemarks[i][c],t[i][c]=new ymaps.Placemark(l.coords,{name:l.num,heading:l.heading,props:l.props,href:l.href},{iconLayout:e[i],iconShape:{type:"Rectangle",coordinates:[[-16,-16],[16,16]]},balloonShadow:!1,balloonLayout:o[i]})}s[i]=new ymaps.Clusterer({preset:"twirl#invertedVioletClusterIcons",groupByCoordinates:!1}),s[i].add(t[i]);for(var p=0;p<t[i].length;p++)a.geoObjects.add(t[i][p])}function d(){a.action.getCurrentState().zoom<17?m("#planYmap").addClass("i-show-infrastructure"):m("#planYmap").removeClass("i-show-infrastructure")}d()})})}(jQuery);