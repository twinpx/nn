!function(f){"use strict";f(function(){function t(e){var h=this;function t(e){for(var t in e)h["$"+t].slider("values",0,e[t][0]),h["$"+t].slider("values",1,e[t][1]),"price"===t?h.$elem.find(".b-filter-"+t+"-value").text(Number(e[t][0]).toLocaleString("ru-RU")+" — "+Number(e[t][1]).toLocaleString("ru-RU")+" руб."):(h["$"+t].find(".ui-slider-handle:eq(0) span").text(e[t][0]),h["$"+t].find(".ui-slider-handle:eq(1) span").text(e[t][1]));u()}function i(e){if(Cookies.get("filter-"+h.$elem.data("tab")))return JSON.parse(Cookies.get("filter-"+h.$elem.data("tab")))[e]}function a(t){var n=1e15,i=0;return h.flatsArray.forEach(function(e){+e[t]&&+e[t]>i&&(i=+e[t]),!isNaN(e[t])&&+e[t]<n&&(n=+e[t])}),1e15===n&&0===i&&(n=0,i=10),[n,i]}function u(){if(h.$tbody.data("filter")&&"object"==typeof h.$tbody.data("filter"))h.flatsArrayFiltered=h.flatsArray.filter(function(e){var t=1;for(var n in h.$tbody.data("filter"))String(e[n])!==String(h.$tbody.data("filter")[n])&&(t*=0);if(t)return!0});else{var e=[];h.$house.length&&e.push(["house","HouseCount"]),h.$section.length&&e.push(["section","SectionNumber"]),h.$floors.length&&e.push(["floors","FloorNumber"]),h.$rooms.length&&e.push(["rooms","FlatRoomsCount"]),h.$square.length&&e.push(["square","TotalArea"]),h.$land.length&&e.push(["land","LandArea"]),h.$price.length&&e.push(["price","Price"]),h.flatsArrayFiltered=h.flatsArray.filter(function(t){var n=1;if(e.forEach(function(e){(t[e[1]]<h["$"+e[0]].slider("values",0)||t[e[1]]>h["$"+e[0]].slider("values",1))&&(n*=0)}),n)return!0})}var m;m="",h.flatsArrayFiltered.forEach(function(e){var t="";e.Action&&(t="i-action");var n,i,a,l,r,o,s,d,u,f,p,$='<tr data-url="'+e.URL+'" class="'+t+'"',c='<td><a href="'+h.$tbody.data("orderlink")+e.ExternalId+'" class="btn">Оставить заявку</a></td></tr>';void 0!==e.HouseCount&&($+=' data-housecount="'+e.HouseCount+'"',n="<td>"+e.HouseCount+"</td>"),void 0!==e.SectionNumber&&($+=' data-sectionnumber="'+e.SectionNumber+'"',i="<td>"+e.SectionNumber+"</td>"),void 0!==e.CorpCount&&($+=' data-corpnumber="'+e.CorpCount+'"',a="<td>"+e.CorpCount+"</td>"),void 0!==e.FloorNumber&&($+=' data-floornumber="'+e.FloorNumber+'"',l="<td>"+e.FloorNumber+"</td>",o=""),void 0!==e.FlatNum&&($+=' data-flatnum="'+e.FlatNum+'"',r="<td>"+e.FlatNum+"</td>"),void 0!==e.FloorsDuplex&&($+=' data-floorsduplex="'+e.FloorsDuplex+'"',o="<td>"+e.FloorsDuplex+"</td>",l=""),void 0!==e.FlatRoomsCount&&($+=' data-flatroomscount="'+e.FlatRoomsCount+'"',s="<td>"+e.FlatRoomsCount+"</td>"),void 0!==e.TotalArea&&($+=' data-totalarea="'+e.TotalArea+'"',d="<td>"+e.TotalArea+" м<sup>2</sup></td>"),void 0!==e.LandArea&&($+=' data-landarea="'+e.LandArea+'"',u=0===e.LandArea?"<td> — </td>":"<td>"+e.LandArea+" сот.</td>"),void 0!==e.Price&&void 0!==e.PriceFormat&&($+=' data-price="'+e.PriceFormat+'"',f='<td data-sort="'+e.Price+'">'+e.PriceFormat+" руб.</td>"),void 0!==e.Finished&&($+=' data-finished="'+e.Finished+'"',p="Y"===e.Finished?'<td class="b-filter-table__finished"><img src="/template/images/finished.svg" title="Отделка завершена" alt="" width="30" height="30"></td>':"<td></td>"),$+=' data-layoutphoto="'+e.LayoutPhoto+'" data-externalid="'+e.ExternalId+'">',m+=$+n+a+i+l+r+o+s+d+u+f+p+c}),h.$tbody.html(m),function(){var e={};h.$house.length&&(e.house=[h.$house.slider("values",0),h.$house.slider("values",1)]);h.$section.length&&(e.section=[h.$section.slider("values",0),h.$section.slider("values",1)]);h.$floors.length&&(e.floors=[h.$floors.slider("values",0),h.$floors.slider("values",1)]);h.$rooms.length&&(e.rooms=[h.$rooms.slider("values",0),h.$rooms.slider("values",1)]);h.$square.length&&(e.square=[h.$square.slider("values",0),h.$square.slider("values",1)]);h.$land.length&&(e.land=[h.$land.slider("values",0),h.$land.slider("values",1)]);h.$price.length&&(e.price=[h.$price.slider("values",0),h.$price.slider("values",1)]);e.filter="",Cookies.set("filter-"+h.$elem.data("tab"),e,{expires:1,path:window.location.pathname})}()}h.flatsArray=[],h.flatsArrayFiltered=[],h.$elem=e,h.$filter=f(".b-filter"),h.$input=h.$elem.find(".b-filter__input input"),h.$tbody=h.$elem.find(".b-filter-table tbody"),h.$reset=h.$elem.find(".b-filter-reset"),h.$mobileBtn=h.$elem.find(".b-filter-btn"),h.$house=h.$elem.find(".b-filter-house"),h.$section=h.$elem.find(".b-filter-section"),h.$floors=h.$elem.find(".b-filter-floors"),h.$rooms=h.$elem.find(".b-filter-rooms"),h.$square=h.$elem.find(".b-filter-square"),h.$land=h.$elem.find(".b-filter-land"),h.$price=h.$elem.find(".b-filter-price"),h.$houseInputMin=h.$elem.find(".b-filter-house-input-min"),h.$houseInputMax=h.$elem.find(".b-filter-house-input-max"),h.$sectionInputMin=h.$elem.find(".b-filter-section-input-min"),h.$sectionInputMax=h.$elem.find(".b-filter-section-input-max"),h.$floorsInputMin=h.$elem.find(".b-filter-floors-input-min"),h.$floorsInputMax=h.$elem.find(".b-filter-floors-input-max"),h.$roomsInputMin=h.$elem.find(".b-filter-rooms-input-min"),h.$roomsInputMax=h.$elem.find(".b-filter-rooms-input-max"),h.$squareInputMin=h.$elem.find(".b-filter-square-input-min"),h.$squareInputMax=h.$elem.find(".b-filter-square-input-max"),h.$landInputMin=h.$elem.find(".b-filter-land-input-min"),h.$landInputMax=h.$elem.find(".b-filter-land-input-max"),h.$priceInputValue=h.$elem.find(".b-filter-price-value"),f.ajax({url:h.$tbody.data("json"),type:h.$tbody.data("method"),dataType:"json",success:function(e){h.flatsArray=e,function(){var n=i("house"),e=a("HouseCount");n=n||e;h.$house.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$house.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$houseInputMin.val(n[0]),h.$house.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$houseInputMax.val(n[1])},slide:function(e,t){h.$house.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$house.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$houseInputMin.val(t.values[0]),h.$houseInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("section"),e=a("SectionCount");n=n||e;h.$section.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$section.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$sectionInputMin.val(n[0]),h.$section.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$sectionInputMax.val(n[1])},slide:function(e,t){h.$section.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$section.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$sectionInputMin.val(t.values[0]),h.$sectionInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("rooms"),e=a("FlatRoomsCount");n=n||e;h.$rooms.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$rooms.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$roomsInputMin.val(n[0]),h.$rooms.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$roomsInputMax.val(n[1])},slide:function(e,t){h.$rooms.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$rooms.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$roomsInputMin.val(t.values[0]),h.$roomsInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("floors"),e=a("FloorNumber");n=n||e;h.$floors.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$floors.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$floorsInputMin.val(n[0]),h.$floors.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$floorsInputMax.val(n[1])},slide:function(e,t){h.$floors.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$floors.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$floorsInputMin.val(t.values[0]),h.$floorsInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("square"),e=a("TotalArea");e=[Math.floor(e[0]),Math.ceil(e[1])],n=n||e;h.$square.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$square.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$squareInputMin.val(n[0]),h.$square.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$squareInputMax.val(n[1])},slide:function(e,t){h.$square.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$square.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$squareInputMin.val(t.values[0]),h.$squareInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("land"),e=a("LandArea");e=[Math.floor(e[0]),Math.ceil(e[1])],n=n||e;h.$land.slider({range:!0,min:e[0],max:e[1],values:[n[0],n[1]],create:function(e,t){h.$land.find(".ui-slider-handle:eq(0)").attr({contenteditable:"true"}).append("<span>"+n[0]+"</span>"),h.$landInputMin.val(n[0]),h.$land.find(".ui-slider-handle:eq(1)").attr({contenteditable:"true"}).append("<span>"+n[1]+"</span>"),h.$landInputMax.val(n[1])},slide:function(e,t){h.$land.find(".ui-slider-handle:eq(0) span").text(t.values[0]),h.$land.find(".ui-slider-handle:eq(1) span").text(t.values[1]),h.$landInputMin.val(t.values[0]),h.$landInputMax.val(t.values[1])},stop:u})}(),function(){var n=i("price"),e=a("Price");n=n||e;h.$price.slider({range:!0,min:e[0],max:e[1],step:1,values:[n[0],n[1]],create:function(e,t){h.$priceInputValue.text(Number(n[0]).toLocaleString("ru-RU")+" — "+Number(n[1]).toLocaleString("ru-RU")+" руб.")},slide:function(e,t){h.$priceInputValue.text(Number(t.values[0]).toLocaleString("ru-RU")+" — "+Number(t.values[1]).toLocaleString("ru-RU")+" руб.")},stop:u})}(),setTimeout(function(){u()},100)},error:function(){}}),h.$reset.click(function(){var e={};h.$house.length&&(e.house=[h.$house.slider("option","min"),h.$house.slider("option","max")]),h.$section.length&&(e.section=[h.$section.slider("option","min"),h.$section.slider("option","max")]),h.$floors.length&&(e.floors=[h.$floors.slider("option","min"),h.$floors.slider("option","max")]),h.$rooms.length&&(e.rooms=[h.$rooms.slider("option","min"),h.$rooms.slider("option","max")]),h.$square.length&&(e.square=[h.$square.slider("option","min"),h.$square.slider("option","max")]),h.$land.length&&(e.land=[h.$land.slider("option","min"),h.$land.slider("option","max")]),h.$price.length&&(e.price=[h.$price.slider("option","min"),h.$price.slider("option","max")]),t(e),h.$input.each(function(e){var t=f(this),n=t.attr("class"),i=n.substring(0,n.search("input")-1);-1!==String(n).search("min")?t.val(h.$elem.find("."+i+" .ui-slider-handle:eq(0) span").text()):t.val(h.$elem.find("."+i+" .ui-slider-handle:eq(1) span").text())})}),h.$mobileBtn.click(function(e){e.preventDefault(),h.$mobileBtn.find("span:visible").is(".i-show")?(h.$elem.find(".b-filter-body").slideDown(),h.$mobileBtn.find("span").show(),h.$mobileBtn.find("span.i-show").hide()):(h.$elem.find(".b-filter-body").slideUp(),h.$mobileBtn.find("span").hide(),h.$mobileBtn.find("span.i-show").show())}),h.$input.keydown(function(e){if(13===e.which){var t,n,i=f(this),a=i.attr("class"),l=+i.val(),r=a.substring(0,a.search("input")-1),o=r.split("b-filter-")[1],s=h.$elem.find("."+r+" .ui-slider-handle:eq(0) span"),d=h.$elem.find("."+r+" .ui-slider-handle:eq(1) span");if("number"==typeof l){if(-1!==String(a).search("min")){if(t=l,n=+i.siblings("input").val(),t>d.text())return void i.val(s.text());t<h["$"+o].slider("option","min")&&(t=h["$"+o].slider("option","min"),i.val(t))}else{if(n=l,t=+i.siblings("input").val(),n<s.text())return void i.val(d.text());n>h["$"+o].slider("option","max")&&(n=h["$"+o].slider("option","max"),i.val(n))}h.$elem.find("."+r).slider("values",0,t),h.$elem.find("."+r).slider("values",1,n),s.text(t),d.text(n),u()}}}),h.slideFilter=u,h.setValue=t,h.$elem.delegate(".btn","click",function(e){e.stopPropagation()}),h.$elem.delegate("tbody tr","click",function(e){e.preventDefault(),window.location=f(this).data("url")})}document.querySelectorAll(".b-filter-table").forEach(function(i){new Tablesort(i),i.addEventListener("afterSort",function(){var e=i.closest(".b-filter-item").querySelector(".b-filter-table thead"),t=f(e).find("th").index(f(e).find("th[aria-sort]")),n=e.querySelector("th[aria-sort]").getAttribute("aria-sort");Cookies.set("table-sort-"+i.closest(".b-filter-item").getAttribute("data-tab"),t+"-"+n,{expires:1,path:window.location.pathname})})}),document.querySelectorAll(".b-filter-item").forEach(function(a){var e=f(a);e.data({Filter:new t(e)}),setTimeout(function(){var e=Cookies.get("table-sort-"+a.getAttribute("data-tab"));if(e){var t=e.split("-")[0],n=e.split("-")[1],i=a.querySelector(".b-filter-table").querySelectorAll("th")[t];f(i).click(),"descending"===n&&f(i).click()}},1e3)}),setTimeout(function(){var e={};window.location.search&&(e=function(e){for(var t={},n=("?"===e[0]?e.substr(1):e).split("&"),i=0;i<n.length;i++){var a=n[i].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]||"")}return t}(window.location.search)),e.type&&f(".b-tabs__item[ data-tab="+e.type+"]").length&&f(".b-tabs__item[ data-tab="+e.type+"]").click(),e.house&&f(".b-filter-item[ data-tab="+e.type+"] .b-filter-house").length&&f(".b-filter-item[ data-tab="+e.type+"]").data("Filter").setValue({house:[e.house,e.house]})},1e3)})}(jQuery);